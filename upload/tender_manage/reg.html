<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<title>公益科普服务平台</title>
		<link href="css/common.css" type="text/css" rel="stylesheet" />
		<link href="js/layer/skin/layer.css" type="text/css" rel="stylesheet" />
	</head>
	<body>
		
		<div id="header" class="clearfix">
			<div class="main">
				<a href="index.html"><img class="logo" src="img/logo.png"/></a>

				<div class="top-btn">
					<span class="login-btn" onclick="window.location.href='login.html'">登录</span>
					<span class="reg-btn" onclick="window.location.href='reg.html'">注册</span>
				</div>


            </div>
		</div>
		

      <div class="main">
          <form id="regForm">
		  <div class="reg">

			  <div class="title" style="width:1158px;margin-left:20px;">注册</div>

			  <div class="reg-main">
			     <div class="child-title">登录信息</div>

				  <div class="reg-row">
                         <label><span>*</span>邮箱</label>
					     <input id="regEmail" name="email" class="required email" isEmail="true" maxlength="50" type="text"/>
				  </div>

				  <div class="reg-row">
					  <label><span>*</span>登录密码</label>
					  <input id="regPass" name="regPass" class="required" minlength="6"  maxlength="20" type="password"/>
				  </div>
				  <div class="reg-row">
					  <label><span>*</span>确认密码</label>
					  <input id="confirmPass" name="confirmPass" class="required" minlength="6" maxlength="20" type="password"/>
				  </div>

				  <div class="btn btn-blue create-btn" id="createAccount" style="margin-bottom:24px;">创建账号</div>

			  </div>

		  </div>
          </form>
	  </div>



		<script src="js/jquery-1.8.1.min.js" type="text/javascript"></script>
		<script src="js/common.js"></script>
		<script src="js/jquery.validate.min.js" type="text/javascript"></script>
		<script src="js/layer/layer.js" type="text/javascript"></script>


		<script>


			$("#regEmail").on('input',function(e){
				//console.log($("#regEmail").val().toLowerCase());
				$("#regEmail").val($("#regEmail").val().toLowerCase());
			});

			$("#regEmail").on('propertychange',function(e){
				//console.log("change");
				$("#regEmail").val($("#regEmail").val().toLowerCase());
			});



			$("#regForm").validate({
				rules: {
					email: {
						required: true
					},
					regPass: {
						required: true
					},
					confirmPass: {
						required: true
					}
				},
				messages: {

					email:{
						required: "请输入邮箱"
					},
					regPass:{
						required: "请输入密码"

					},
					confirmPass:{
						required: "请再次输入密码"

					}
				},
				submitHandler: function() {


					var email=$("#regEmail").val();
					var password=$("#regPass").val();


					$.ajax({
						url: serverUrl + "users",
						type: 'post',
						contentType: 'application/json; charset=utf-8',
						dataType: "json",
						data: JSON.stringify({
							username:email,
							password:password
						}),
						success: function (data) {

							console.log(data);
							if(data.code==1000)
							{
								layer.alert("注册成功！",function()
								{
									window.location.href="login.html";
								});

							}
							else if(data.code==1805)
							{
								layer.alert("此邮箱已经存在！");
							}
						}
					});


				}
			});

			$(document).ready(function() {

				$("#regForm").validate({
					rules: {
						confirmPass: {
							required: true,
							minlength: 6,
							equalTo: "#regPass"
						}

					},
					messages: {
						confirmPass: {
							required: "请输入密码",
							minlength: "密码长度不能小于 6 个字母",
							equalTo: "两次密码输入不一致"
						}
					}
				});



				$("#createAccount").click(function () {

					$("#createAccount").submit();


				});

			});







		</script>




		
	</body>
</html>
