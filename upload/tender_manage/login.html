<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<title>公益科普服务平台</title>
		<link href="css/common.css" type="text/css" rel="stylesheet" />
		<link href="js/layer/skin/layer.css" type="text/css" rel="stylesheet" />
	</head>
	<body>
		
		<div id="header" class="clearfix">
			<div class="main">
				<a href="index.html"><img class="logo" src="img/logo.png"/></a>
            </div>
		</div>
		

        <div class="top-space"></div>
		<div class="login">

			<form id="loginForm">
			<div class="login-title">账号登录</div>

			<div class="login-row">
				<input id="email"  name="email" class="email" maxlength="50" value="" isEmail="true" placeholder="邮箱" type="text">
			</div>

			<div class="login-row" id="passRow">
				<input id="pass" name="pass"  maxlength="40" value=""  placeholder="密码" type="password">
			</div>

			<div class="check">
			<input id="remember" type="checkbox"/><span>记住我</span>
			</div>

			<div class="login-btn" id="login-btn">登&nbsp;&nbsp;录</div>

			<div class="login-bottom">
				<a  class="forget" href="forget_pass.html">忘记密码</a>
				<a  class="reg-link" href="reg.html">现在就去注册</a>
			</div>
			</form>
		</div>

		<p class="right">© 2016 公益科普服务平台 All Rights Reserved</p>



		<script src="js/jquery-1.8.1.min.js" type="text/javascript"></script>
		<script src="js/common.js"></script>
		<script src="js/jquery.validate.min.js" type="text/javascript"></script>
		<script src="js/layer/layer.js" type="text/javascript"></script>
		<script>

			if(getCookie("email"))
			{
				$("#email").val(getCookie("email"));
			}
			if(getCookie("pass"))
			{
				$("#pass").val(getCookie("pass"));
			}


		/*	$("#email").on('input',function(e){
				//console.log($("#regEmail").val().toLowerCase());
				$("#email").val($("#email").val().toLowerCase());
			});

			$("#email").on('propertychange',function(e){
				//console.log("change");
				$("#email").val($("#email").val().toLowerCase());
			});*/


			$("#loginForm").validate({
				rules: {
					email: {
						required: true
					},
					pass: {
						required: true
					}
				},
				messages: {

					email:{
						required: "请输入邮箱"
					},
					pass:{
						required: "请输入密码"

					}
				},
				submitHandler: function() {

					var email=$("#email").val();
					var password=$("#pass").val();

					$.ajax({
						url: serverUrl + "login",
						type: 'post',
						contentType: 'application/json; charset=utf-8',
						dataType: "json",
						data: JSON.stringify({
							username:email,
							password:password
						}),
						success: function (data) {

							console.log(JSON.stringify(data));

							if(data.code==1000)
							{
								setCookie("user",JSON.stringify(data),30);

								if($("#remember").prop("checked"))
								{
									setCookie("email",$("#email").val(),365);
									setCookie("pass",$("#pass").val(),365);
								}

								window.location.href="index.html";

							}
							else {
								layer.alert(msg);
							}
						},
						error:function(msg)
						{
							layer.alert("网络异常！");
						}
					});


				}
			});


			$(document).ready(function() {


				$("#loginForm").validate();

				$("#login-btn").click(function () {

					$("#login-btn").submit();


				});

			});

		</script>
		
		
	</body>
</html>
